heat_template_version: 2015-10-15

description: >
  config : userdata config custom
parameters:
  config_file:
    type: string
    description: config_file path
  ansible_config:
    type: string
    description: ansible_config env group_vars path

resources:
  userdata:
    type: OS::Heat::CloudConfig
    properties:
      cloud_config:
        merge_how: 'list(append)+dict(recurse_array)+str()'
        write_files:
        - path: /root/install_docker_node.sh
          content:
            str_replace:
              params:
                $config_file: { get_param: config_file }
                $ansible_config: { get_param: ansible_config }
              template: { get_file: ../config-scripts/install_docker_node.sh }
          owner: root:root
          permissions: '0750'
        runcmd:
          - /root/install_docker_node.sh

## Note: is executed before cloud-init/runcmd
#  userdata:
#    type: "OS::Heat::SoftwareConfig"
#    properties:
#      group: ungrouped
#      config:
#        str_replace:
#          params:
#            $config_file: { get_param: config_file }
#          template: { get_file: ../config-scripts/install_docker_node.sh }
#
outputs:
  userdata:
    value: {get_resource: userdata}
